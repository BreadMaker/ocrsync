const electron=require("electron");const{ipcRenderer:ipcRenderer,shell:shell}=electron;let template=String(),latestOCR=Number(),currentOCR=localStorage.getItem("OCRCurrent")===null?3617:parseInt(localStorage.getItem("OCRCurrent")),filesSynced=0,animationIsEnabled=true,now=Date(),db=new Dexie("OCRDB");function getTextNodesIn(e,t){var n=[],i=/\S/;function r(e){if(e.nodeType==3){if(t||i.test(e.nodeValue)){n.push(e)}}else{for(var a=0,s=e.childNodes.length;a<s;++a){r(e.childNodes[a])}}}r(e);return n}function enableSyncIn30Seconds(){var e=(3e4-parseInt(new Date-now))/1e3;if(e>0){$("#OCRRetryTime").html(parseInt(e)+"<small>"+(e%1).toFixed(3).substring(1)+"</small>");requestAnimationFrame(enableSyncIn30Seconds)}else{$("#OCRRetryMessage").removeClass("muted text").html("<a id='OCRRetry' href='#'>Check again?</a>")}}function updateSyncStatus(){var e=latestOCR-currentOCR;if(e===0){ipcRenderer.send("OCR:DisableSyncMenu");$("#OCRSyncButton").attr("disabled","disabled");$("#OCRStatus").html("<i class='icons'><i class='green check icon'></i><i class='corner sync icon'></i></i> Synchronized");$("#OCRRetryMessage").html("Please wait <span id='OCRRetryTime'></span>s to check again.");now=new Date;enableSyncIn30Seconds()}else if(e>0){ipcRenderer.send("OCR:EnableSyncMenu");$("#OCRSyncButton").removeAttr("disabled");$("#OCRStatus").html("<i class='exclamation triangle icon'></i> Out of sync. "+e+" missing.")}else{ipcRenderer.send("OCR:DisableSyncMenu");$("#OCRSyncButton").attr("disabled","disabled");$("#OCRStatus").html("<i class='exclamation icon'></i> Something weird happened")}}function checkSyncStatus(){$.get("http://ocremix.org/feeds/ten20/",function(e){latestOCR=parseInt($(e).find("item:first link").text().split("/")[4].replace("OCR",""));updateSyncStatus()}).fail(function(){$("#OCRStatus").html("<i class='exclamation icon'></i> There was a problem trying to check sync status.")})}function downloadOCReMix(){if(currentOCR<latestOCR){currentOCR+=1;localStorage.setItem("OCRCurrent",currentOCR);db.remix.where({number:currentOCR}).first(e=>{$("#OCRSyncProgressDetail").prepend(Mustache.render(template,e));ipcRenderer.send("OCR:URLReady",currentOCR,e.links,localStorage.getItem("OCRDirectory"),e.md5sum)}).catch(e=>{$.get("http://ocremix.org/remix/OCR"+currentOCR.toString().padStart(5,"0"),function(e){var t=$(e,document.implementation.createHTMLDocument());var n=$(".color-secondary:contains('ReMix')",t).parents("div:first");var i=getTextNodesIn($("h1",n)[0]);var r={number:currentOCR,thumb:e.split('og:image" content="')[1].split('"')[0].replace("ocremix.org","ocremix.org/thumbs/100"),game:i[1].textContent,title:i[2].textContent+" "+$("h2",n).text(),links:Array(),md5sum:$("dl dt:contains('MD5')",t).next("dd").text()};$("#modalDownload ul li a",t).each(function(){if(!this.href.includes("iterations")){r.links.push(this.href)}});$("#OCRSyncProgressDetail").prepend(Mustache.render(template,r));db.remix.put(r);ipcRenderer.send("OCR:URLReady",currentOCR,r.links,localStorage.getItem("OCRDirectory"),r.md5sum)})})}else if(currentOCR===latestOCR){$("#OCRSyncOverallStatus .header").text("Sync Complete");$("#OCRCancelSyncButton").hide();$("#OCRDoneSyncButton").show()}}var triangleArray=[];function initCanvas(){$("#OCRLoadingScreen").remove();$("#OCRMainScreen").removeClass("transparent");var e=document.getElementById("OCRBackgroundCanvas");var t=e.width=window.innerWidth;var n=e.height=window.innerHeight;var i=e.getContext("2d",{alpha:false});var r=document.getElementById("OCRForegroundCanvas");r.width=window.innerWidth;r.height=window.innerHeight;var a=r.getContext("2d");function s(){a.font='bold 48px "Expletus Sans"';a.fillStyle="#444";a.textBaseline="middle";a.textAlign="center";a.fillText("OCRSync",window.innerWidth/2,150)}s();var o=document.getElementById("OCRIntroCanvas");o.width=window.innerWidth;o.height=window.innerHeight;var l=o.getContext("2d");l.fillStyle="white";l.fillRect(0,0,window.innerWidth,window.innerHeight);function c(e,t,n,r){this.x=e;this.y=t;this.status=n;this.up=r;this.deltaLight=Math.random()<.5?h(0,.6):h(0,-.6);this.statusColor=function(e){this.status=e;if(this.status==="error"){this.hue=0;this.saturation="100%";this.lightMin=90;this.lightMax=100}else if(this.status==="warning"){this.hue=60;this.saturation="60%";this.lightMin=60;this.lightMax=100}else{this.hue=Number();this.saturation="0%";this.lightMin=80;this.lightMax=100}this.lightness=h(this.lightMin,this.lightMax)};this.statusColor();this.draw=function(){i.fillStyle="hsl("+this.hue+", "+this.saturation+", "+this.lightness+"%)";if(this.up){i.beginPath();i.moveTo(this.x,this.y);i.lineTo(e+20,this.y+40);i.lineTo(e-20,this.y+40);i.closePath();i.fill()}else{i.beginPath();i.moveTo(this.x,this.y);i.lineTo(e+40,this.y);i.lineTo(e+20,this.y+40);i.closePath();i.fill()}};this.update=function(){this.lightness+=this.deltaLight;if(this.lightness>this.lightMax||this.lightness<this.lightMin){this.deltaLight*=-1}this.draw()}}function h(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function d(e){var i=Math.ceil(t/40)+1;var r=Math.ceil(n/40);var a,s;for(s=0;s<r;s++){for(a=0;a<i;a++){var o=a*40;var l=s*40;if(s%2!=0){o-=20}triangleArray.push(new c(o,l,e,true));triangleArray.push(new c(o,l,e,false))}}}function u(){for(var e=0;e<triangleArray.length;e++){triangleArray[e].update()}}var C=30;var g;var R=Date.now();var m=1e3/C;var f;function p(){if(animationIsEnabled){requestAnimationFrame(p);g=Date.now();f=g-R;if(f>m){R=g-f%m;u()}}}d();p();var O=100;function y(){l.clearRect(0,0,window.innerWidth,window.innerHeight);l.globalAlpha=O/100;l.fillStyle="white";l.fillRect(0,0,window.innerWidth,window.innerHeight);if(O>=0){requestAnimationFrame(y)}else{$("#OCRIntroCanvas").remove();$("#OCRSyncScreen").removeClass("transparent")}O-=2}y();function S(){animationIsEnabled=true;$("#OCRMainScreen").removeClass("showingSync").one("transitionend",function(){$("#OCRSyncProgressDetail").empty();p()})}$("#OCRCancelSyncButton button").click(function(e){e.preventDefault();currentOCR-=1;localStorage.setItem("OCRCurrent",currentOCR);ipcRenderer.send("OCR:StopSync");S()});$("#OCRDoneSyncButton button").click(function(e){e.preventDefault();S()});$(window).resize(function(){e.width=window.innerWidth;e.height=window.innerHeight;a.clearRect(0,0,r.width,r.height);r.width=window.innerWidth;r.height=window.innerHeight;s()})}function showConfig(e){$("#OCRConfigModal").modal({onApprove:function(){if(e){initSync()}}}).modal("show")}function initSync(){if(localStorage.getItem("OCRDirectory")===null){$("#OCRInitModal").modal({onApprove:function(){showConfig(true)}}).modal("show")}else{$(".modal").modal("hide");animationIsEnabled=false;$("#OCRMainScreen").addClass("showingSync");$("#OCRSyncOverallProgress .progress").progress({label:"ratio",total:latestOCR-currentOCR});downloadOCReMix()}}$(document).ready(function(){db.version(1).stores({remix:"number,thumb,game,title,links,md5sum"});db.open();template=$("#OCRItemTemplate").html();$(".ui.modal").modal();$("#OCRConfigModal .help").each(function(){$(this).popup({target:$(this).find(".target")})});document.fonts.ready.then(function(){if(document.fonts.check('1em "Expletus Sans"')){$("body").removeClass("expletus");initCanvas()}});ipcRenderer.on("OCR:DownloadProgress",function(e,t,n){$("#OCReMix-"+n+" .progress").progress({percent:t*100}).progress("set label","Downloading")});ipcRenderer.on("OCR:MD5Check",function(e,t,n){switch(n){case"start":$("#OCReMix-"+t+" .progress").progress("set label","Checking Download");break;case"correct":$("#OCReMix-"+t+" .progress").progress("set percent",100).progress("set label","Download Completed!");$("#OCRSyncOverallProgress .progress").progress("set progress",filesSynced+=1);updateSyncStatus();downloadOCReMix();break;case"mismatch":$("#OCReMix-"+t+" .progress").addClass("warning").progress("set percent",100).progress("set label","Warning: MD5 Mismatch");$("#OCRSyncOverallProgress .progress").progress("set progress",filesSynced+=1);updateSyncStatus();downloadOCReMix();break}});$("#OCRConfigButton").click(function(){showConfig(false)});ipcRenderer.on("OCR:ShowConfig",function(){showConfig(false)});$("#OCRSelectDirectoryButton").click(function(e){e.preventDefault();ipcRenderer.send("OCR:SelectDirectory")});ipcRenderer.on("OCR:DirectorySelected",function(e,t){if(t!==null){localStorage.setItem("OCRDirectory",t[0]);$("#OCRDirectory").val(t[0])}});$("#OCRAboutButton").click(function(){$("#OCRAboutModal").modal("show")});ipcRenderer.on("OCR:ShowAbout",function(){$("#OCRAboutModal").modal("show")});$("#OCRSyncButton").click(function(e){e.preventDefault();initSync()});ipcRenderer.on("OCR:InitSync",function(){initSync()});if(localStorage.getItem("OCRDirectory")!==null){$("#OCRDirectory").val(localStorage.getItem("OCRDirectory"))}$(".current.year").text((new Date).getFullYear());$("a").click(function(e){e.preventDefault();shell.openExternal($(this).attr("href"))});$("#OCRCreditsButton").state({text:{inactive:"Credits",active:"About"}}).click(function(){$(".shape").shape("flip back")});$("body").on("click","#OCRRetry",function(e){e.preventDefault();$("#OCRRetryMessage").empty().addClass("muted text");$("#OCRStatus").html("<i class='asterisk loading icon'></i> Connecting&hellip;");checkSyncStatus()});checkSyncStatus()});
//# sourceMappingURL=index.min.js.map