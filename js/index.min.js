const electron=require("electron");const{ipcRenderer:ipcRenderer,shell:shell}=electron;var template=String(),latestOCR=Number(),currentOCR=localStorage.getItem("OCRCurrent")===null?3617:parseInt(localStorage.getItem("OCRCurrent")),filesSynced=0;$.fn.random=function(){return this.eq(Math.floor(Math.random()*this.length))};function sleep(t){return new Promise(e=>setTimeout(e,t))}function getTextNodesIn(t,e){var n=[],i=/\S/;function r(t){if(t.nodeType==3){if(e||i.test(t.nodeValue)){n.push(t)}}else{for(var o=0,a=t.childNodes.length;o<a;++o){r(t.childNodes[o])}}}r(t);return n}function updateSyncStatus(){var t=latestOCR-currentOCR;if(t===0){$("#OCRSyncButton").attr("disabled","disabled");$("#OCRStatus").html("<i class='icons'><i class='green check icon'></i><i class='corner sync icon'></i></i> Synchronized")}else if(t>0){$("#OCRSyncButton").removeAttr("disabled");$("#OCRStatus").html("<i class='exclamation triangle icon'></i> Out of sync. "+t+" missing.")}else{$("#OCRSyncButton").attr("disabled","disabled");$("#OCRStatus").html("<i class='exclamation icon'></i> Something weird happened")}}function checkSyncStatus(){$.get("http://ocremix.org/feeds/ten20/",function(t){latestOCR=parseInt($(t).find("item:first link").text().split("/")[4].replace("OCR",""));updateSyncStatus()}).fail(function(){$("#OCRStatus").html("<i class='exclamation icon'></i> There was a problem trying to check sync status.")})}function downloadOCReMix(){if(currentOCR<latestOCR){currentOCR=currentOCR+1;localStorage.setItem("OCRCurrent",currentOCR);$.get("http://ocremix.org/remix/OCR"+currentOCR.toString().padStart(5,"0"),function(t){var e=$(t,document.implementation.createHTMLDocument());var n=$(".color-secondary:contains('ReMix')",e).parents("div:first");var i=getTextNodesIn($("h1",n)[0]);$("#OCRSyncProgressDetail").prepend(Mustache.render(template,{remix:currentOCR,thumb:t.split('og:image" content="')[1].split('"')[0].replace("ocremix.org","ocremix.org/thumbs/100"),game:i[1].textContent,title:i[2].textContent+" "+$("h2",n).text()}));ipcRenderer.send("OCR:URLReady",currentOCR,$("#modalDownload ul li a:not([href*='iterations'])",e).random()[0].href,localStorage.getItem("OCRDirectory"),$("dl dt:contains('MD5')",e).next("dd").text())})}else if(currentOCR===latestOCR){$("#OCRSyncOverallStatus .header").text("Sync Complete");$("#OCRCancelSyncButton button").attr("disabled","disabled")}}var triangleArray=[];function initCanvas(){$("#OCRLoadingScreen").remove();$("#OCRMainScreen").removeClass("transparent");var t=document.getElementById("OCRBackgroundCanvas");var e=t.width=window.innerWidth;var n=t.height=window.innerHeight;var i=t.getContext("2d",{alpha:false});var r=document.getElementById("OCRForegroundCanvas");r.width=window.innerWidth;r.height=window.innerHeight;var o=r.getContext("2d");function a(){o.font='bold 48px "Expletus Sans"';o.fillStyle="#444";o.textBaseline="middle";o.textAlign="center";o.fillText("OCRSync",window.innerWidth/2,150)}a();var s=document.getElementById("OCRIntroCanvas");s.width=window.innerWidth;s.height=window.innerHeight;var l=s.getContext("2d");l.fillStyle="white";l.fillRect(0,0,window.innerWidth,window.innerHeight);function c(t,e,n,r){this.x=t;this.y=e;this.status=n;this.up=r;this.deltaLight=Math.random()<.5?h(0,.6):h(0,-.6);this.statusColor=function(t){this.status=t;if(this.status==="error"){this.hue=0;this.saturation="100%";this.lightMin=90;this.lightMax=100}else if(this.status==="warning"){this.hue=60;this.saturation="60%";this.lightMin=60;this.lightMax=100}else{this.hue=Number();this.saturation="0%";this.lightMin=80;this.lightMax=100}this.lightness=h(this.lightMin,this.lightMax)};this.statusColor();this.draw=function(){i.fillStyle="hsl("+this.hue+", "+this.saturation+", "+this.lightness+"%)";if(this.up){i.beginPath();i.moveTo(this.x,this.y);i.lineTo(t+20,this.y+40);i.lineTo(t-20,this.y+40);i.closePath();i.fill()}else{i.beginPath();i.moveTo(this.x,this.y);i.lineTo(t+40,this.y);i.lineTo(t+20,this.y+40);i.closePath();i.fill()}};this.update=function(){this.lightness+=this.deltaLight;if(this.lightness>this.lightMax||this.lightness<this.lightMin){this.deltaLight*=-1}this.draw()}}function h(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function d(t){var i=Math.ceil(e/40)+1;var r=Math.ceil(n/40);var o,a;for(a=0;a<r;a++){for(o=0;o<i;o++){var s=o*40;var l=a*40;if(a%2!=0){s-=20}triangleArray.push(new c(s,l,t,true));triangleArray.push(new c(s,l,t,false))}}}function u(){for(var t=0;t<triangleArray.length;t++){triangleArray[t].update()}}var g=30;var C;var f=Date.now();var R=1e3/g;var m;function p(){requestAnimationFrame(p);C=Date.now();m=C-f;if(m>R){f=C-m%R;u()}}d();p();var O=100;function w(){l.clearRect(0,0,window.innerWidth,window.innerHeight);l.globalAlpha=O/100;l.fillStyle="white";l.fillRect(0,0,window.innerWidth,window.innerHeight);if(O>=0){requestAnimationFrame(w)}else{$("#OCRIntroCanvas").remove();$("#OCRSyncScreen").removeClass("transparent")}O-=2}w();$(window).resize(function(){t.width=window.innerWidth;t.height=window.innerHeight;o.clearRect(0,0,r.width,r.height);r.width=window.innerWidth;r.height=window.innerHeight;a()})}function showConfig(t){$("#OCRConfigModal").modal({onApprove:function(){if(t){initSync()}}}).modal("show")}function backToMainScreen(){$("#OCRMainScreen").removeClass("showingSync")}function initSync(){if(localStorage.getItem("OCRDirectory")===null){$("#OCRInitModal").modal({onApprove:function(){showConfig(true)}}).modal("show")}else{$(".modal").modal("hide");$("#OCRMainScreen").addClass("showingSync");$("#OCRSyncOverallProgress .progress").progress({label:"ratio",total:latestOCR-currentOCR});downloadOCReMix()}}$(document).ready(function(){template=$("#OCRItemTemplate").html();$(".ui.modal").modal();$("#OCRConfigModal .help").each(function(){$(this).popup({target:$(this).find(".target")})});document.fonts.ready.then(function(){if(document.fonts.check('1em "Expletus Sans"')){$("body").removeClass("expletus");initCanvas()}});var t=Number();ipcRenderer.on("OCR:DownloadProgress",function(e,n,i){$("#OCReMix-"+i+" .progress").progress({percent:n*100}).progress("set label","Downloading");t=n});ipcRenderer.on("OCR:MD5Check",function(t,e,n){switch(n){case"start":$("#OCReMix-"+e+" .progress").progress("set label","Checking Download");break;case"correct":$("#OCReMix-"+e+" .progress").progress("set percent",100).progress("set label","Download Completed!");$("#OCRSyncOverallProgress .progress").progress("set progress",filesSynced+=1);updateSyncStatus();downloadOCReMix();break;case"mismatch":$("#OCReMix-"+e+" .progress").progress("set label","Error: MD5 Mismatch");break}});$("#OCRConfigButton").click(function(){showConfig(false)});ipcRenderer.on("OCR:ShowConfig",function(){showConfig(false)});$("#OCRSelectDirectoryButton").click(function(t){t.preventDefault();ipcRenderer.send("OCR:SelectDirectory")});ipcRenderer.on("OCR:DirectorySelected",function(t,e){if(e!==null){localStorage.setItem("OCRDirectory",e[0]);$("#OCRDirectory").val(e[0])}});$("#OCRAboutButton").click(function(){$("#OCRAboutModal").modal("show")});ipcRenderer.on("OCR:ShowAbout",function(){$("#OCRAboutModal").modal("show")});$("#OCRSyncButton").click(function(t){t.preventDefault();initSync()});ipcRenderer.on("OCR:InitSync",function(){initSync()});if(localStorage.getItem("OCRDirectory")!==null){$("#OCRDirectory").val(localStorage.getItem("OCRDirectory"))}$(".current.year").text((new Date).getFullYear());$("a").click(function(t){t.preventDefault();shell.openExternal($(this).attr("href"))});$("#OCRCreditsButton").state({text:{inactive:"Credits",active:"About"}}).click(function(){$(".shape").shape("flip back")});checkSyncStatus()});
//# sourceMappingURL=index.min.js.map